<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Budget Planer</title>

  <!-- Schriftart -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800;900&display=swap" rel="stylesheet" />

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Chart.js (Diagramme) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- docx (Word-Export) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.0.1/docx.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- App -->
  <script defer src="app.js"></script>
</head>
<body class="theme-standard">
  <!-- Hamburger-Menü-Button (oben, sicher mit Dynamic Island) -->
  <button id="menuButton"
          class="menu-button"
          aria-label="Menü öffnen"
          aria-controls="menuOverlay"
          aria-expanded="false">
    <span class="menu-icon" aria-hidden="true"></span>
  </button>

  <!-- Vollbild-Menü-Overlay mit vertikalen Tabs -->
  <aside id="menuOverlay" class="menu-overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="menu-backdrop" id="menuBackdrop"></div>
    <div class="menu-sheet" role="menu" aria-label="Hauptmenü">
      <header class="menu-header">
        <h3>Menü</h3>
        <button id="closeMenu" class="menu-close" aria-label="Menü schliessen">×</button>
      </header>
      <nav class="menu-list">
        <button class="menu-item" data-tab="budget" role="menuitem" aria-controls="tab-budget">Budget</button>
        <button class="menu-item" data-tab="list" role="menuitem" aria-controls="tab-list">Auflistung</button>
        <button class="menu-item" data-tab="history" role="menuitem" aria-controls="tab-history">Verlauf</button>
        <button class="menu-item" data-tab="saved" role="menuitem" aria-controls="tab-saved">Gespart</button>
        <button class="menu-item" data-tab="categories" role="menuitem" aria-controls="tab-categories">Kategorien</button>
        <button class="menu-item" data-tab="settings" role="menuitem" aria-controls="tab-settings">Einstellungen</button>
        <button class="menu-item" data-tab="archive" role="menuitem" aria-controls="tab-archive">Archiv</button>
      </nav>
    </div>
  </aside>

  <!-- Seitenkopf -->
  <header class="panel header-panel" role="banner">
    <div id="greeting" class="muted">Hallo –</div>
    <h2 id="monthRange">
      <span id="budgetWord" class="gradient-text">Dein Budget</span>
      <span>für&nbsp;<span id="monthText">–</span></span>
    </h2>
    <div id="currentDate" class="muted">–</div>
    <p id="quote" class="quote" aria-live="polite"></p>
  </header>

  <!-- Hauptinhalt -->
  <main class="main-content" id="appRoot" role="main">
    <!-- TAB: Budget -->
    <section id="tab-budget" class="tab active" role="region" aria-label="Budget">
      <div class="panel">
        <label for="totalBudget" class="muted">Gesamtbudget (CHF)</label>
        <div class="input-row">
          <input id="totalBudget" type="number" inputmode="decimal" min="0" step="0.05" placeholder="0.00" />
          <button id="saveBudget" class="btn btn-primary" type="button">Speichern</button>
        </div>
      </div>

      <div class="panel">
        <label for="txCategory" class="muted">Kategorie</label>
        <select id="txCategory" aria-label="Kategorie auswählen"></select>

        <label for="txDesc" class="muted">Beschreibung</label>
        <input id="txDesc" type="text" maxlength="60" placeholder="z.B. Wocheneinkauf" />

        <label for="txAmount" class="muted">Betrag (CHF)</label>
        <input id="txAmount" type="number" inputmode="decimal" min="0" step="0.05" placeholder="0.00" />

        <button id="addTx" class="btn btn-primary" type="button">Hinzufügen</button>
      </div>

      <div class="panel kpi-row">
        <div class="kpi">
          <div class="kpi-label">Ausgegeben</div>
          <div id="spent" class="kpi-value">CHF 0.00</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">Verbleibend</div>
          <div id="remaining" class="kpi-value big">CHF 0.00</div>
        </div>
      </div>
    </section>

    <!-- TAB: Auflistung -->
    <section id="tab-list" class="tab" role="region" aria-label="Auflistung">
      <div id="transactionList" class="panel list-panel" aria-live="polite"></div>
    </section>

    <!-- TAB: Verlauf -->
    <section id="tab-history" class="tab" role="region" aria-label="Verlauf">
      <div class="panel">
        <canvas id="expenseChart" width="420" height="320" aria-label="Ausgaben-Diagramm" role="img"></canvas>
      </div>
      <div id="historyList" class="panel list-panel"></div>
    </section>

    <!-- TAB: Gespart -->
    <section id="tab-saved" class="tab" role="region" aria-label="Gespart">
      <div class="panel">
        <h3>Gespart in dieser Periode</h3>
        <p><strong id="savedAmount">CHF 0.00</strong></p>
        <small class="muted">Periode richtet sich nach deinem Zahltag.</small>
      </div>
    </section>

    <!-- TAB: Kategorien -->
    <section id="tab-categories" class="tab" role="region" aria-label="Kategorien">
      <div class="panel">
        <h3>Kategorien verwalten</h3>
        <div class="input-row">
          <input id="newCategoryName" type="text" maxlength="24" placeholder="Neue Kategorie (z.B. Essen)" />
          <button id="addCategory" class="btn btn-primary" type="button">Hinzufügen</button>
        </div>
        <div id="categoriesList" class="chips"></div>
        <small class="muted">Tipp: Tippe auf eine Kategorie, um sie umzubenennen. Langer Druck: löschen.</small>
      </div>
    </section>

    <!-- TAB: Einstellungen -->
    <section id="tab-settings" class="tab" role="region" aria-label="Einstellungen">
      <div class="panel">
        <h3>Farbschema wählen</h3>
        <!-- Buttons zeigen ihre echten Farben, unabhängig vom aktuellen Theme -->
        <div class="theme-grid">
          <button class="theme-btn theme-swatch-standard" data-theme-select="standard" type="button" title="Grün/gelb">Standard</button>
          <button class="theme-btn theme-swatch-warm" data-theme-select="warm" type="button" title="Rot/orange">Warm</button>
          <button class="theme-btn theme-swatch-kalt" data-theme-select="kalt" type="button" title="Blau/hellblau">Kalt</button>
          <button class="theme-btn theme-swatch-fancy" data-theme-select="fancy" type="button" title="Sättigtes Mint/Türkis">Fancy</button>
          <button class="theme-btn theme-swatch-special" data-theme-select="special" type="button" title="Violett/gelb">Special</button>
          <button class="theme-btn theme-swatch-girly" data-theme-select="girly" type="button" title="Pink/violett">Girly</button>
        </div>
      </div>

      <div class="panel">
        <h3>Exporte</h3>
        <div class="export-grid">
          <button id="exportWord" class="btn btn-primary" type="button">Verlauf als Word</button>
          <button id="exportCSV" class="btn btn-primary" type="button">Verlauf als CSV</button>
          <button id="exportChart" class="btn btn-primary" type="button">Diagramm als PNG</button>
        </div>
        <small class="muted">Es wird die aktuelle Periode exportiert (definiert durch deinen Zahltag).</small>
      </div>

      <div class="panel">
        <h3>Zahltag</h3>
        <div class="input-row">
          <input id="paydaySelectSettings" type="number" min="1" max="28" step="1" placeholder="1–28" />
          <button id="savePaydaySettings" class="btn btn-primary" type="button">Speichern</button>
        </div>
        <small class="muted">Am Zahltag wird automatisch archiviert und das Budget zurückgesetzt.</small>
      </div>
    </section>

    <!-- TAB: Archiv -->
    <section id="tab-archive" class="tab" role="region" aria-label="Archiv">
      <div id="archiveList" class="panel list-panel"></div>
    </section>
  </main>

  <!-- Popups (Onboarding: Willkommen → Info → Kategorien-Hinweis → Zahltag) -->
  <div id="welcomeModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="welcomeTitle">
    <div class="modal-content">
      <h3 id="welcomeTitle">Willkommen!</h3>
      <p>Wie heisst du?</p>
      <input id="userName" type="text" maxlength="24" placeholder="Dein Name" />
      <button id="saveName" class="btn btn-primary" type="button">Speichern</button>
    </div>
  </div>

  <div id="infoModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="infoTitle">
    <div class="modal-content">
      <h3 id="infoTitle">Kurzinfo</h3>
      <p>Ich helfe dir dabei, Ausgaben zu erfassen, Kategorien zu ordnen und am Zahltag alles sauber zu archivieren. So behältst du den Überblick und sparst smarter.</p>
      <button id="closeInfo" class="btn btn-primary" type="button">Weiter</button>
    </div>
  </div>

  <div id="categoryInfoModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="catInfoTitle">
    <div class="modal-content">
      <h3 id="catInfoTitle">Noch ein Schritt</h3>
      <p>Lege zuerst deine eigenen Kategorien an. Danach kannst du im Reiter <strong>Budget</strong> Ausgaben hinzufügen.</p>
      <button id="closeCategoryInfo" class="btn btn-primary" type="button">Weiter</button>
    </div>
  </div>

  <div id="paydayModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="paydayTitle">
    <div class="modal-content">
      <h3 id="paydayTitle">Zahltag festlegen</h3>
      <p>Wähle deinen monatlichen Zahltag (1–28). An diesem Tag wird automatisch archiviert.</p>
      <input id="paydaySelect" type="number" min="1" max="28" step="1" placeholder="z.B. 20" />
      <button id="savePayday" class="btn btn-primary" type="button">Speichern</button>
    </div>
  </div>

  <!-- Live-Region für kurze Statusmeldungen (Screenreader) -->
  <div id="sr-status" class="sr-only" aria-live="polite" aria-atomic="true"></div>
</body>
</html>
